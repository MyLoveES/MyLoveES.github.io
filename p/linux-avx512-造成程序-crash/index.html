<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="èƒŒæ™¯ æœåŠ¡è¿è¡Œä¸èµ·æ¥ï¼Œps auxæŸ¥çœ‹stateå§‹ç»ˆå¤„åœ¨ Dl+ çŠ¶æ€\næŸ¥çœ‹dmesgæˆ–è€…cat /var/log/messagesï¼Œå‘ç° trap invalid opcode å’Œ segfault at. æŸ¥è¿‡åï¼Œå¯èƒ½æ˜¯æŒ‡ä»¤é›†é—®é¢˜ã€‚\nè§£é‡Š ip:c14490 sp:7f975324f790 error:0 in xxxx[400000+53a3d000]\nå…¶ä¸­ï¼Œ\nip: æŒ‡ä»¤(å†…å­˜)æŒ‡é’ˆ sp: å †æ ˆæŒ‡é’ˆåœ°å€ï¼ˆæ ˆé¡¶æŒ‡é’ˆï¼‰ [xxxx+yyyy] : è™šæ‹Ÿå†…å­˜èµ·å§‹åœ°å€ã€å¤§å° error number: 4 -> 100 bit2: å€¼ä¸º1è¡¨ç¤ºæ˜¯ç”¨æˆ·æ€ç¨‹åºå†…å­˜è®¿é—®è¶Šç•Œï¼Œå€¼ä¸º0è¡¨ç¤ºæ˜¯å†…æ ¸æ€ç¨‹åºå†…å­˜è®¿é—®è¶Šç•Œ\nbit1: å€¼ä¸º1è¡¨ç¤ºæ˜¯å†™æ“ä½œå¯¼è‡´å†…å­˜è®¿é—®è¶Šç•Œï¼Œå€¼ä¸º0è¡¨ç¤ºæ˜¯è¯»æ“ä½œå¯¼è‡´å†…å­˜è®¿é—®è¶Šç•Œ\nbit0: å€¼ä¸º1è¡¨ç¤ºæ²¡æœ‰è¶³å¤Ÿçš„æƒé™è®¿é—®éæ³•åœ°å€çš„å†…å®¹ï¼Œå€¼ä¸º0è¡¨ç¤ºè®¿é—®çš„éæ³•åœ°å€æ ¹æœ¬æ²¡æœ‰å¯¹åº”çš„é¡µé¢ï¼Œä¹Ÿå°±æ˜¯æ— æ•ˆåœ°å€\nå‡ºé”™åœ°å€ï¼š 0xc14490 - 0x400000 = 0x814490\nåæ±‡ç¼–ï¼Œæ‰§è¡Œ(å¾ˆä¸å¹¸ï¼Œæˆ‘åç¼–è¯‘å¤±è´¥äº†)\n1 objdump -D xxxx > obj æ£€ç´¢ 0814490 å°è¯•åœ¨è€CPUä¸Šé‡æ–°ç¼–è¯‘ï¼Œè¿è¡Œæ— é”™ã€‚\nref: https://blog.csdn.net/wangtingting_100/article/details/83749504\nref: https://stackoverflow.com/questions/2549214/interpreting-segfault-messages\nref: https://utcc.utoronto.ca/~cks/space/blog/linux/KernelSegfaultMessageMeaning\n"><title>Linux - AVX512 é€ æˆç¨‹åº crash</title><link rel=canonical href=https://MyLoveES.github.io/p/linux-avx512-%E9%80%A0%E6%88%90%E7%A8%8B%E5%BA%8F-crash/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="Linux - AVX512 é€ æˆç¨‹åº crash"><meta property='og:description' content="èƒŒæ™¯ æœåŠ¡è¿è¡Œä¸èµ·æ¥ï¼Œps auxæŸ¥çœ‹stateå§‹ç»ˆå¤„åœ¨ Dl+ çŠ¶æ€\næŸ¥çœ‹dmesgæˆ–è€…cat /var/log/messagesï¼Œå‘ç° trap invalid opcode å’Œ segfault at. æŸ¥è¿‡åï¼Œå¯èƒ½æ˜¯æŒ‡ä»¤é›†é—®é¢˜ã€‚\nè§£é‡Š ip:c14490 sp:7f975324f790 error:0 in xxxx[400000+53a3d000]\nå…¶ä¸­ï¼Œ\nip: æŒ‡ä»¤(å†…å­˜)æŒ‡é’ˆ sp: å †æ ˆæŒ‡é’ˆåœ°å€ï¼ˆæ ˆé¡¶æŒ‡é’ˆï¼‰ [xxxx+yyyy] : è™šæ‹Ÿå†…å­˜èµ·å§‹åœ°å€ã€å¤§å° error number: 4 -> 100 bit2: å€¼ä¸º1è¡¨ç¤ºæ˜¯ç”¨æˆ·æ€ç¨‹åºå†…å­˜è®¿é—®è¶Šç•Œï¼Œå€¼ä¸º0è¡¨ç¤ºæ˜¯å†…æ ¸æ€ç¨‹åºå†…å­˜è®¿é—®è¶Šç•Œ\nbit1: å€¼ä¸º1è¡¨ç¤ºæ˜¯å†™æ“ä½œå¯¼è‡´å†…å­˜è®¿é—®è¶Šç•Œï¼Œå€¼ä¸º0è¡¨ç¤ºæ˜¯è¯»æ“ä½œå¯¼è‡´å†…å­˜è®¿é—®è¶Šç•Œ\nbit0: å€¼ä¸º1è¡¨ç¤ºæ²¡æœ‰è¶³å¤Ÿçš„æƒé™è®¿é—®éæ³•åœ°å€çš„å†…å®¹ï¼Œå€¼ä¸º0è¡¨ç¤ºè®¿é—®çš„éæ³•åœ°å€æ ¹æœ¬æ²¡æœ‰å¯¹åº”çš„é¡µé¢ï¼Œä¹Ÿå°±æ˜¯æ— æ•ˆåœ°å€\nå‡ºé”™åœ°å€ï¼š 0xc14490 - 0x400000 = 0x814490\nåæ±‡ç¼–ï¼Œæ‰§è¡Œ(å¾ˆä¸å¹¸ï¼Œæˆ‘åç¼–è¯‘å¤±è´¥äº†)\n1 objdump -D xxxx > obj æ£€ç´¢ 0814490 å°è¯•åœ¨è€CPUä¸Šé‡æ–°ç¼–è¯‘ï¼Œè¿è¡Œæ— é”™ã€‚\nref: https://blog.csdn.net/wangtingting_100/article/details/83749504\nref: https://stackoverflow.com/questions/2549214/interpreting-segfault-messages\nref: https://utcc.utoronto.ca/~cks/space/blog/linux/KernelSegfaultMessageMeaning\n"><meta property='og:url' content='https://MyLoveES.github.io/p/linux-avx512-%E9%80%A0%E6%88%90%E7%A8%8B%E5%BA%8F-crash/'><meta property='og:site_name' content='Kunkka'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='Linux'><meta property='article:tag' content='å†…æ ¸'><meta property='article:tag' content='AVX512'><meta property='article:tag' content='æ•…éšœæ’æŸ¥'><meta property='article:published_time' content='2022-03-07T00:00:00+00:00'><meta property='article:modified_time' content='2022-03-07T00:00:00+00:00'><meta name=twitter:title content="Linux - AVX512 é€ æˆç¨‹åº crash"><meta name=twitter:description content="èƒŒæ™¯ æœåŠ¡è¿è¡Œä¸èµ·æ¥ï¼Œps auxæŸ¥çœ‹stateå§‹ç»ˆå¤„åœ¨ Dl+ çŠ¶æ€\næŸ¥çœ‹dmesgæˆ–è€…cat /var/log/messagesï¼Œå‘ç° trap invalid opcode å’Œ segfault at. æŸ¥è¿‡åï¼Œå¯èƒ½æ˜¯æŒ‡ä»¤é›†é—®é¢˜ã€‚\nè§£é‡Š ip:c14490 sp:7f975324f790 error:0 in xxxx[400000+53a3d000]\nå…¶ä¸­ï¼Œ\nip: æŒ‡ä»¤(å†…å­˜)æŒ‡é’ˆ sp: å †æ ˆæŒ‡é’ˆåœ°å€ï¼ˆæ ˆé¡¶æŒ‡é’ˆï¼‰ [xxxx+yyyy] : è™šæ‹Ÿå†…å­˜èµ·å§‹åœ°å€ã€å¤§å° error number: 4 -> 100 bit2: å€¼ä¸º1è¡¨ç¤ºæ˜¯ç”¨æˆ·æ€ç¨‹åºå†…å­˜è®¿é—®è¶Šç•Œï¼Œå€¼ä¸º0è¡¨ç¤ºæ˜¯å†…æ ¸æ€ç¨‹åºå†…å­˜è®¿é—®è¶Šç•Œ\nbit1: å€¼ä¸º1è¡¨ç¤ºæ˜¯å†™æ“ä½œå¯¼è‡´å†…å­˜è®¿é—®è¶Šç•Œï¼Œå€¼ä¸º0è¡¨ç¤ºæ˜¯è¯»æ“ä½œå¯¼è‡´å†…å­˜è®¿é—®è¶Šç•Œ\nbit0: å€¼ä¸º1è¡¨ç¤ºæ²¡æœ‰è¶³å¤Ÿçš„æƒé™è®¿é—®éæ³•åœ°å€çš„å†…å®¹ï¼Œå€¼ä¸º0è¡¨ç¤ºè®¿é—®çš„éæ³•åœ°å€æ ¹æœ¬æ²¡æœ‰å¯¹åº”çš„é¡µé¢ï¼Œä¹Ÿå°±æ˜¯æ— æ•ˆåœ°å€\nå‡ºé”™åœ°å€ï¼š 0xc14490 - 0x400000 = 0x814490\nåæ±‡ç¼–ï¼Œæ‰§è¡Œ(å¾ˆä¸å¹¸ï¼Œæˆ‘åç¼–è¯‘å¤±è´¥äº†)\n1 objdump -D xxxx > obj æ£€ç´¢ 0814490 å°è¯•åœ¨è€CPUä¸Šé‡æ–°ç¼–è¯‘ï¼Œè¿è¡Œæ— é”™ã€‚\nref: https://blog.csdn.net/wangtingting_100/article/details/83749504\nref: https://stackoverflow.com/questions/2549214/interpreting-segfault-messages\nref: https://utcc.utoronto.ca/~cks/space/blog/linux/KernelSegfaultMessageMeaning\n"><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_c68a00bbf16dac8.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ¥</span></figure><div class=site-meta><h1 class=site-name><a href=/>Kunkka</a></h1><h2 class=site-description>wind rises</h2></div></header><ol class=menu-social><li><a href=https://github.com/MyLoveES target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=/index.xml target=_blank title=RSS rel=me><svg class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/about><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/archives><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/all-categories><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
<span>Categories</span></a></li><li><a href=/links><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li><a href=/all-tags><svg class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11 3l9 9a1.5 1.5.0 010 2l-6 6a1.5 1.5.0 01-2 0L3 11V7a4 4 0 014-4h4"/><circle cx="9" cy="9" r="2"/></svg>
<span>Tags</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#èƒŒæ™¯>èƒŒæ™¯</a></li><li><a href=#è§£é‡Š>è§£é‡Š</a></li><li><a href=#è´´ä¸€ä¸‹-starkoverflow-ä¸Šçš„æ“ä½œ>è´´ä¸€ä¸‹ starkoverflow ä¸Šçš„æ“ä½œ</a><ol><li><a href=#if-this-were-a-program-not-a-shared-library><strong>If this were a program, not a shared library</strong></a></li><li><a href=#since-it><strong>Since itâ€™s a shared library</strong></a></li><li><a href=#what-the-error-means>What the error means</a></li></ol></li><li><a href=#è´´å¦ä¸€ä¸ªblogæ›´è¯¦å°½çš„è§£é‡Š>è´´å¦ä¸€ä¸ªblogï¼Œæ›´è¯¦å°½çš„è§£é‡Š</a><ol><li><a href=#what-the-linux-kernels-messages-about-segfaulting-programs-mean-on-64-bit-x86>What the Linux kernel&rsquo;s messages about segfaulting programs mean on 64-bit x86</a><ol><li><a href=#sidebar-the-various-error-code-bits-as-numbers>Sidebar: The various error code bits as numbers</a></li></ol></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/%E6%8A%80%E6%9C%AF/>æŠ€æœ¯</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/linux-avx512-%E9%80%A0%E6%88%90%E7%A8%8B%E5%BA%8F-crash/>Linux - AVX512 é€ æˆç¨‹åº crash</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Mar 07, 2022</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>8 minute read</time></div></footer></div></header><section class=article-content><h2 id=èƒŒæ™¯>èƒŒæ™¯</h2><p>æœåŠ¡è¿è¡Œä¸èµ·æ¥ï¼Œps auxæŸ¥çœ‹stateå§‹ç»ˆå¤„åœ¨ Dl+ çŠ¶æ€<br>æŸ¥çœ‹dmesgæˆ–è€…cat /var/log/messagesï¼Œå‘ç° <strong>trap invalid opcode</strong> å’Œ <strong>segfault at</strong>. æŸ¥è¿‡åï¼Œå¯èƒ½æ˜¯æŒ‡ä»¤é›†é—®é¢˜ã€‚</p><p><img src=/p/linux-avx512-%E9%80%A0%E6%88%90%E7%A8%8B%E5%BA%8F-crash/trap_invalid_opcode.jpg width=1121 height=37 srcset="/p/linux-avx512-%E9%80%A0%E6%88%90%E7%A8%8B%E5%BA%8F-crash/trap_invalid_opcode_hu_208e01d83f47f57f.jpg 480w, /p/linux-avx512-%E9%80%A0%E6%88%90%E7%A8%8B%E5%BA%8F-crash/trap_invalid_opcode_hu_aa37a05603223947.jpg 1024w" loading=lazy class=gallery-image data-flex-grow=3029 data-flex-basis=7271px></p><p><img src=/p/linux-avx512-%E9%80%A0%E6%88%90%E7%A8%8B%E5%BA%8F-crash/segment_at.jpg width=1258 height=102 srcset="/p/linux-avx512-%E9%80%A0%E6%88%90%E7%A8%8B%E5%BA%8F-crash/segment_at_hu_f46476abc67da1c4.jpg 480w, /p/linux-avx512-%E9%80%A0%E6%88%90%E7%A8%8B%E5%BA%8F-crash/segment_at_hu_c4d156986e7c0ba.jpg 1024w" loading=lazy class=gallery-image data-flex-grow=1233 data-flex-basis=2960px></p><h2 id=è§£é‡Š>è§£é‡Š</h2><p>ip:c14490 sp:7f975324f790 error:0 in xxxx[400000+53a3d000]<br>å…¶ä¸­ï¼Œ</p><ul><li>ip: æŒ‡ä»¤(å†…å­˜)æŒ‡é’ˆ</li><li>sp: å †æ ˆæŒ‡é’ˆåœ°å€ï¼ˆæ ˆé¡¶æŒ‡é’ˆï¼‰</li><li>[xxxx+yyyy] : è™šæ‹Ÿå†…å­˜èµ·å§‹åœ°å€ã€å¤§å°</li><li>error number: 4 -> 100</li></ul><blockquote><p>bit2: å€¼ä¸º1è¡¨ç¤ºæ˜¯ç”¨æˆ·æ€ç¨‹åºå†…å­˜è®¿é—®è¶Šç•Œï¼Œå€¼ä¸º0è¡¨ç¤ºæ˜¯å†…æ ¸æ€ç¨‹åºå†…å­˜è®¿é—®è¶Šç•Œ<br>bit1: å€¼ä¸º1è¡¨ç¤ºæ˜¯å†™æ“ä½œå¯¼è‡´å†…å­˜è®¿é—®è¶Šç•Œï¼Œå€¼ä¸º0è¡¨ç¤ºæ˜¯è¯»æ“ä½œå¯¼è‡´å†…å­˜è®¿é—®è¶Šç•Œ<br>bit0: å€¼ä¸º1è¡¨ç¤ºæ²¡æœ‰è¶³å¤Ÿçš„æƒé™è®¿é—®éæ³•åœ°å€çš„å†…å®¹ï¼Œå€¼ä¸º0è¡¨ç¤ºè®¿é—®çš„éæ³•åœ°å€æ ¹æœ¬æ²¡æœ‰å¯¹åº”çš„é¡µé¢ï¼Œä¹Ÿå°±æ˜¯æ— æ•ˆåœ°å€</p></blockquote><p>å‡ºé”™åœ°å€ï¼š 0xc14490 - 0x400000 = 0x814490</p><p>åæ±‡ç¼–ï¼Œæ‰§è¡Œ(å¾ˆä¸å¹¸ï¼Œæˆ‘åç¼–è¯‘å¤±è´¥äº†)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>objdump -D xxxx &gt; obj
</span></span></code></pre></td></tr></table></div></div><p>æ£€ç´¢ 0814490
å°è¯•åœ¨è€CPUä¸Šé‡æ–°ç¼–è¯‘ï¼Œè¿è¡Œæ— é”™ã€‚</p><blockquote><p>ref: <a class=link href=https://blog.csdn.net/wangtingting_100/article/details/83749504 target=_blank rel=noopener>https://blog.csdn.net/wangtingting_100/article/details/83749504</a><br>ref: <a class=link href=https://stackoverflow.com/questions/2549214/interpreting-segfault-messages target=_blank rel=noopener>https://stackoverflow.com/questions/2549214/interpreting-segfault-messages</a><br>ref: <a class=link href=https://utcc.utoronto.ca/~cks/space/blog/linux/KernelSegfaultMessageMeaning target=_blank rel=noopener>https://utcc.utoronto.ca/~cks/space/blog/linux/KernelSegfaultMessageMeaning</a></p></blockquote><h2 id=è´´ä¸€ä¸‹-starkoverflow-ä¸Šçš„æ“ä½œ>è´´ä¸€ä¸‹ starkoverflow ä¸Šçš„æ“ä½œ</h2><h3 id=if-this-were-a-program-not-a-shared-library><strong>If this were a program, not a shared library</strong></h3><p>Run <code>addr2line -e yourSegfaultingProgram c14490</code> (and repeat for the other instruction pointer valUes given) to see where the error is happening. Better, get a debug-instrumented build, and reproduce the problem under a debugger such as gdb.</p><h3 id=since-it><strong>Since it&rsquo;s a shared library</strong></h3><p>You&rsquo;re hosed, unfortunately; it&rsquo;s not possible to know where the libraries were placed in memory by the dynamic linker after-the-fact. Reproduce the problem under gdb.</p><h3 id=what-the-error-means>What the error means</h3><p>Here&rsquo;s the breakdown of the fields:</p><ul><li>address (after the at) - the location in memory the code is trying to access (it&rsquo;s likely that c14490 are offsets from a pointer we expect to be set to a valid value but which is instead pointing to 0)</li><li>ip - instruction pointer, ie. where the code which is trying to do this lives (æŒ‡ä»¤æŒ‡é’ˆï¼Œå³å°è¯•æ‰§è¡Œæ­¤æ“ä½œçš„ä»£ç æ‰€åœ¨çš„ä½ç½®)</li><li>sp - stack pointer (å †æ ˆæŒ‡é’ˆ)</li><li>error - An error code for page faults; see below for what this means on x86 <a class=link href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/tree/arch/x86/include/asm/trap_pf.h?h=v5.16#n5" target=_blank rel=noopener>link</a>.</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/*
</span></span><span class=line><span class=cl> * Page fault error code bits:
</span></span><span class=line><span class=cl> *
</span></span><span class=line><span class=cl> *   bit 0 ==    0: no page found       1: protection fault
</span></span><span class=line><span class=cl> *   bit 1 ==    0: read access         1: write access
</span></span><span class=line><span class=cl> *   bit 2 ==    0: kernel-mode access  1: user-mode access
</span></span><span class=line><span class=cl> *   bit 3 ==                           1: use of reserved bit detected
</span></span><span class=line><span class=cl> *   bit 4 ==                           1: fault was an instruction fetch
</span></span><span class=line><span class=cl> *   bit 5 ==                           1: protection keys block access
</span></span><span class=line><span class=cl> *   bit 15 ==                          1: SGX MMU page-fault
</span></span><span class=line><span class=cl> */
</span></span></code></pre></td></tr></table></div></div><h2 id=è´´å¦ä¸€ä¸ªblogæ›´è¯¦å°½çš„è§£é‡Š>è´´å¦ä¸€ä¸ªblogï¼Œæ›´è¯¦å°½çš„è§£é‡Š</h2><h3 id=what-the-linux-kernels-messages-about-segfaulting-programs-mean-on-64-bit-x86>What the Linux kernel&rsquo;s messages about segfaulting programs mean on 64-bit x86</h3><p>For quite a while the Linux kernel has had an option to log a kernel message about every faulting user program, and it probably defaults to on in your Linux distribution. I&rsquo;ve seen these messages fly by for years, but for reasons beyond the scope of this entry I&rsquo;ve recently wanted to understand what they mean in some moderate amount of detail.</p><p>å¾ˆé•¿ä¸€æ®µæ—¶é—´ä»¥æ¥ï¼ŒLinux å†…æ ¸éƒ½æœ‰ä¸€ä¸ªé€‰é¡¹æ¥è®°å½•æœ‰å…³æ¯ä¸ªé”™è¯¯ç”¨æˆ·ç¨‹åºçš„å†…æ ¸æ¶ˆæ¯ï¼Œå¹¶ä¸”å®ƒå¯èƒ½åœ¨æ‚¨çš„ Linux å‘è¡Œç‰ˆä¸­é»˜è®¤ä¸ºå¼€å¯ã€‚å¤šå¹´æ¥ï¼Œæˆ‘ä¸€ç›´çœ‹åˆ°è¿™äº›æ¶ˆæ¯é£æ¥é£å»ï¼Œä½†ç”±äºè¶…å‡ºæœ¬æ–‡èŒƒå›´çš„åŸå› ï¼Œæˆ‘æœ€è¿‘æƒ³ä»¥é€‚åº¦çš„ç»†èŠ‚äº†è§£å®ƒä»¬çš„å«ä¹‰ã€‚</p><p>I&rsquo;ll start with a straightforward and typical example, one that I see every time I build and test Go (as this is a test case that is supposed to crash):<br>æˆ‘å°†ä»ä¸€ä¸ªç®€å•è€Œå…¸å‹çš„ç¤ºä¾‹å¼€å§‹ï¼Œæˆ‘æ¯æ¬¡æ„å»ºå’Œæµ‹è¯• Go æ—¶éƒ½ä¼šçœ‹åˆ°è¿™ä¸ªç¤ºä¾‹ï¼ˆå› ä¸ºè¿™æ˜¯ä¸€ä¸ªåº”è¯¥å´©æºƒçš„æµ‹è¯•ç”¨ä¾‹ï¼‰ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>testp[19288]: segfault at 0 ip 0000000000401271 sp 00007fff2ce4d210 error 4 in testp[400000+98000]
</span></span></code></pre></td></tr></table></div></div><p>The meaning of this is:</p><ul><li>&rsquo;testp[19288]&rsquo; is the faulting program and its PID</li><li>&lsquo;segfault at 0&rsquo; tells us the memory address (in hex) that caused the segfault when the program tried to access it. Here the address is 0, so we have a null dereference of some sort.(å‘Šè¯‰æˆ‘ä»¬å½“ç¨‹åºè¯•å›¾è®¿é—®å®ƒæ—¶å¯¼è‡´æ®µé”™è¯¯çš„å†…å­˜åœ°å€ï¼ˆåå…­è¿›åˆ¶ï¼‰ã€‚è¿™é‡Œçš„åœ°å€æ˜¯ 0ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰æŸç§ç±»å‹çš„ç©ºè§£å¼•ç”¨ã€‚)</li><li>&lsquo;ip 0000000000401271&rsquo; is the value of the instruction pointer at the time of the fault. This should be the instruction that attempted to do the invalid memory access. In 64-bit x86, this will be register %rip (useful for inspecting things in GDB and elsewhere).(æ˜¯æ•…éšœæ—¶æŒ‡ä»¤æŒ‡é’ˆçš„å€¼ã€‚è¿™åº”è¯¥æ˜¯è¯•å›¾è¿›è¡Œæ— æ•ˆå†…å­˜è®¿é—®çš„æŒ‡ä»¤ã€‚åœ¨ 64 ä½ x86 ä¸­ï¼Œè¿™å°†æ˜¯å¯„å­˜å™¨ %ripï¼ˆç”¨äºæ£€æŸ¥ GDB å’Œå…¶ä»–åœ°æ–¹çš„å†…å®¹ï¼‰)</li><li>&lsquo;sp 00007fff2ce4d210&rsquo; is the value of the stack pointer. In 64-bit x86, this will be %rsp.(æ˜¯å †æ ˆæŒ‡é’ˆçš„å€¼ã€‚åœ¨ 64 ä½ x86 ä¸­ï¼Œè¿™å°†æ˜¯ %rspã€‚)(æ˜¯æ¥è‡ªtraps.herror 4çš„åå…­è¿›åˆ¶é¡µé¢é”™è¯¯ä»£ç ä½ ï¼Œå’Œå¾€å¸¸ä¸€æ ·ï¼Œå‡ ä¹æ€»æ˜¯è‡³å°‘ä¸º 4ï¼ˆè¿™æ„å‘³ç€â€œç”¨æˆ·æ¨¡å¼è®¿é—®â€ï¼‰ã€‚å€¼ 4 è¡¨ç¤ºè¯»å–æœªæ˜ å°„åŒºåŸŸï¼Œä¾‹å¦‚åœ°å€ 0ï¼Œè€Œå€¼ 6 (4+2) è¡¨ç¤ºå†™å…¥æœªæ˜ å°„åŒºåŸŸ)</li><li>&rsquo;error 4&rsquo; is the page fault error code bits from traps.h in hex, as usual, and will almost always be at least 4 (which means &lsquo;user-mode access&rsquo;). A value of 4 means it was a read of an unmapped area, such as address 0, while a value of 6 (4+2) means it was a write of an unmapped area.</li><li>&lsquo;in testp[400000+98000]&rsquo; tells us the specific virtual memory area that the instruction pointer is in, specifying which file it is (here it&rsquo;s the executable), the starting address that VMA is mapped at (0x400000), and the size of the mapping (0x98000).(å‘Šè¯‰æˆ‘ä»¬æŒ‡ä»¤æŒ‡é’ˆæ‰€åœ¨çš„ç‰¹å®šè™šæ‹Ÿå†…å­˜åŒºåŸŸï¼ŒæŒ‡å®šå®ƒæ˜¯å“ªä¸ªæ–‡ä»¶ï¼ˆè¿™é‡Œæ˜¯å¯æ‰§è¡Œæ–‡ä»¶ï¼‰ï¼ŒVMA æ˜ å°„çš„èµ·å§‹åœ°å€ï¼ˆ0x400000ï¼‰ï¼Œä»¥åŠæ˜ å°„çš„å¤§å°ï¼ˆ0x98000ï¼‰)</li></ul><p>With a faulting address of 0 and an error code of 4, we know this particular segfault is a read of a null pointer.<br>é”™è¯¯åœ°å€ä¸º 0ï¼Œé”™è¯¯ä»£ç ä¸º 4ï¼Œæˆ‘ä»¬çŸ¥é“è¿™ä¸ªç‰¹å®šçš„æ®µé”™è¯¯æ˜¯å¯¹ç©ºæŒ‡é’ˆçš„è¯»å–ã€‚<br>Here&rsquo;s two more error messages:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>bash[12235]: segfault at 1054808 ip 000000000041d989 sp 00007ffec1f1cbd8 error 6 in bash[400000+f4000]
</span></span></code></pre></td></tr></table></div></div><p>&lsquo;Error 6&rsquo; means a write to an unmapped user address, here 0x1054808.<br>â€œé”™è¯¯ 6â€è¡¨ç¤ºå†™å…¥æœªæ˜ å°„çš„ç”¨æˆ·åœ°å€ï¼Œæ­¤å¤„ä¸º 0x1054808ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>bash[11909]: segfault at 0 ip 00007f83c03db746 sp 00007ffccbeda010 error 4 in libc-2.23.so[7f83c0350000+1c0000]
</span></span></code></pre></td></tr></table></div></div><p>Error 4 and address 0 is a null pointer read but this time it&rsquo;s in some libc function, not in bash&rsquo;s own code, since it&rsquo;s reported as &lsquo;in libc-2.23.so[&mldr;]&rsquo;. Since I looked at the core dump, I can tell you that this was in strlen().<br>é”™è¯¯ 4 å’Œåœ°å€ 0 æ˜¯è¯»å–çš„ç©ºæŒ‡é’ˆï¼Œä½†è¿™æ¬¡æ˜¯åœ¨æŸä¸ª libc å‡½æ•°ä¸­ï¼Œè€Œä¸æ˜¯åœ¨ bash è‡ªå·±çš„ä»£ç ä¸­ï¼Œå› ä¸ºå®ƒè¢«æŠ¥å‘Šä¸ºâ€œåœ¨ libc-2.23.so[&mldr;]â€ä¸­ã€‚ç”±äºæˆ‘æŸ¥çœ‹äº†æ ¸å¿ƒè½¬å‚¨ï¼Œæˆ‘å¯ä»¥å‘Šè¯‰ä½ è¿™æ˜¯åœ¨strlen().<br>On 64-bit x86 Linux, you&rsquo;ll get a somewhat different message if the problem is actually with the instruction being executed, not the address it&rsquo;s referencing. For example:
åœ¨ 64 ä½ x86 Linux ä¸Šï¼Œå¦‚æœé—®é¢˜å®é™…ä¸Šå‡ºåœ¨æ­£åœ¨æ‰§è¡Œçš„æŒ‡ä»¤ä¸Šï¼Œè€Œä¸æ˜¯å®ƒæ‰€å¼•ç”¨çš„åœ°å€ä¸Šï¼Œé‚£ä¹ˆæ‚¨å°†æ”¶åˆ°ä¸€æ¡ç¨å¾®ä¸åŒçš„æ¶ˆæ¯ã€‚ä¾‹å¦‚ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>bash[2848] trap invalid opcode ip:48db90 sp:7ffddc8879e8 error:0 in bash[400000+f4000]
</span></span></code></pre></td></tr></table></div></div><p>There are a number of such trap types set up in traps.c. Two notable additional ones are &lsquo;divide error&rsquo;, which you get if you do an integer division by zero, and &lsquo;general protection&rsquo;, which you can get for certain extremely wild pointers (one case I know of is when your 64-bit x86 address is not in &lsquo;canonical form&rsquo;). Although these fields are formatted slightly differently, most of them mean the same thing as in segfaults. The exception is &rsquo;error:0&rsquo;, which is not a page fault error code. I don&rsquo;t understand the relevant kernel code enough to know what it means, but if I&rsquo;m reading between the lines correctly in entry_64.txt, then it&rsquo;s either 0 (the usual case) or an error code from the CPU. Here is one possible list of exceptions that get error codes.
åœ¨traps.cä¸­è®¾ç½®äº†è®¸å¤šæ­¤ç±»é™·é˜±ç±»å‹ã€‚ä¸¤ä¸ªå€¼å¾—æ³¨æ„çš„é™„åŠ é”™è¯¯æ˜¯â€œé™¤æ³•é”™è¯¯â€ï¼Œå¦‚æœä½ å°†æ•´æ•°é™¤ä»¥é›¶ï¼Œä½ ä¼šå¾—åˆ°å®ƒï¼Œä»¥åŠâ€œä¸€èˆ¬ä¿æŠ¤â€ï¼Œä½ å¯ä»¥å¾—åˆ°æŸäº›éå¸¸ç‹‚é‡çš„æŒ‡é’ˆï¼ˆæˆ‘çŸ¥é“çš„ä¸€ç§æƒ…å†µæ˜¯å½“ä½ çš„ 64 ä½ x86åœ°å€ä¸æ˜¯â€œè§„èŒƒå½¢å¼â€ï¼‰ã€‚å°½ç®¡è¿™äº›å­—æ®µçš„æ ¼å¼ç•¥æœ‰ä¸åŒï¼Œä½†å®ƒä»¬ä¸­çš„å¤§å¤šæ•°ä¸æ®µé”™è¯¯ä¸­çš„å«ä¹‰ç›¸åŒã€‚ä¾‹å¤–æ˜¯â€œ error:0â€ï¼Œå®ƒä¸æ˜¯é¡µé¢é”™è¯¯é”™è¯¯ä»£ç ã€‚æˆ‘å¯¹ç›¸å…³å†…æ ¸ä»£ç çš„ç†è§£ä¸è¶³ä»¥çŸ¥é“å®ƒçš„å«ä¹‰ï¼Œä½†æ˜¯å¦‚æœæˆ‘åœ¨entry_64.txtä¸­çš„è¡Œä¹‹é—´æ­£ç¡®è¯»å–ï¼Œé‚£ä¹ˆå®ƒè¦ä¹ˆæ˜¯ 0ï¼ˆé€šå¸¸æƒ…å†µï¼‰ï¼Œè¦ä¹ˆæ˜¯æ¥è‡ª CPU çš„é”™è¯¯ä»£ç ã€‚è¿™é‡Œæ˜¯è·å–é”™è¯¯ä»£ç çš„ä¸€ä¸ªå¯èƒ½çš„å¼‚å¸¸åˆ—è¡¨ã€‚</p><p>Sometimes these messages can be a little bit unusual and surprising. Here is a silly sample program and the error it produces when run. The code:
æœ‰æ—¶è¿™äº›æ¶ˆæ¯å¯èƒ½æœ‰ç‚¹ä¸å¯»å¸¸å’Œä»¤äººæƒŠè®¶ã€‚è¿™æ˜¯ä¸€ä¸ªæ„šè ¢çš„ç¤ºä¾‹ç¨‹åºä»¥åŠå®ƒåœ¨è¿è¡Œæ—¶äº§ç”Ÿçš„é”™è¯¯ã€‚ä»£ç ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>   <span class=kt>int</span> <span class=p>(</span><span class=o>*</span><span class=n>p</span><span class=p>)();</span>
</span></span><span class=line><span class=cl>   <span class=n>p</span> <span class=o>=</span> <span class=mh>0x0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>   <span class=k>return</span> <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=p>(</span><span class=o>*</span><span class=n>p</span><span class=p>)());</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>If compiled (without optimization is best) and run, this generates the kernel message:
å¦‚æœç¼–è¯‘ï¼ˆæœ€å¥½æ²¡æœ‰ä¼˜åŒ–ï¼‰å¹¶è¿è¡Œï¼Œè¿™ä¼šç”Ÿæˆå†…æ ¸æ¶ˆæ¯ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>a.out[3714]: segfault at 0 ip           (null) sp 00007ffe872aa418 error 14 in a.out[400000+1000]
</span></span></code></pre></td></tr></table></div></div><p>The &lsquo;(null)&rsquo; bit turns out to be expected; it&rsquo;s what the general kernel printf() function generates when asked to print something as a pointer and it&rsquo;s null (as seen here). In our case the instruction pointer is 0 (null) because we&rsquo;ve made a subroutine call through a null pointer and thus we&rsquo;re trying to execute code at address 0. I don&rsquo;t know why the &lsquo;in &mldr;&rsquo; portion says that we&rsquo;re in the executable (although in this case the call actually was there).</p><p>The error code of 14 is in hex, which means that as bits it&rsquo;s 010100. This is a user mode read of an unmapped area (our usual &lsquo;4&rsquo; case), but it&rsquo;s an instruction fetch, not a normal data read or write. Any error 14s are a sign of some form of mangled function call or a return to a mangled address because the stack has been mashed.</p><p>&rsquo; (null)&rsquo; ä½æ˜¯é¢„æœŸçš„ï¼›è¿™æ˜¯ä¸€èˆ¬å†…æ ¸ printf() å‡½æ•°åœ¨è¢«è¦æ±‚å°†æŸäº›å†…å®¹ä½œä¸ºæŒ‡é’ˆæ‰“å°å¹¶ä¸”å®ƒä¸º null æ—¶ç”Ÿæˆçš„å†…å®¹ï¼ˆå¦‚æ­¤å¤„æ‰€ç¤ºï¼‰ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼ŒæŒ‡ä»¤æŒ‡é’ˆä¸º 0ï¼ˆç©ºï¼‰ï¼Œå› ä¸ºæˆ‘ä»¬é€šè¿‡ç©ºæŒ‡é’ˆè¿›è¡Œäº†å­ç¨‹åºè°ƒç”¨ï¼Œå› æ­¤æˆ‘ä»¬è¯•å›¾åœ¨åœ°å€ 0 å¤„æ‰§è¡Œä»£ç ã€‚æˆ‘ä¸çŸ¥é“ä¸ºä»€ä¹ˆâ€œin &mldr;â€éƒ¨åˆ†è¡¨ç¤ºæˆ‘ä»¬åœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼ˆå°½ç®¡åœ¨è¿™ç§æƒ…å†µä¸‹è°ƒç”¨å®é™…ä¸Šåœ¨é‚£é‡Œï¼‰ã€‚</p><p>é”™è¯¯ä»£ç  14 æ˜¯åå…­è¿›åˆ¶çš„ï¼Œè¿™æ„å‘³ç€å®ƒçš„ä½æ˜¯ 010100ã€‚è¿™æ˜¯å¯¹æœªæ˜ å°„åŒºåŸŸçš„ç”¨æˆ·æ¨¡å¼è¯»å–ï¼ˆæˆ‘ä»¬é€šå¸¸çš„â€œ4â€æƒ…å†µï¼‰ï¼Œä½†å®ƒæ˜¯æŒ‡ä»¤è·å–ï¼Œè€Œä¸æ˜¯æ­£å¸¸çš„æ•°æ®è¯»å–æˆ–å†™å…¥ã€‚ä»»ä½•é”™è¯¯ 14s éƒ½æ˜¯æŸç§å½¢å¼çš„å‡½æ•°è°ƒç”¨é”™è¯¯æˆ–è¿”å›åˆ°é”™è¯¯åœ°å€çš„æ ‡å¿—ï¼Œå› ä¸ºå †æ ˆå·²è¢«æ··åˆã€‚</p><p>(These bits turn out to come straight from the CPU&rsquo;s page fault IDT.) .</p><p>For 64-bit x86 Linux kernels (and possibly for 32-bit x86 ones as well), the code you want to look at is show_signal_msg in fault.c, which prints the general &lsquo;segfault at ..&rsquo; message, do_trap and do_general_protection in traps.c, which print the &rsquo;trap &mldr;&rsquo; messages, and print_vma_addr in memory.c, which prints the &lsquo;in &mldr;&rsquo; portion for all of these messages.</p><h4 id=sidebar-the-various-error-code-bits-as-numbers>Sidebar: The various error code bits as numbers</h4><div class=table-wrapper><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>+1</td><td>protection fault in a mapped area (eg writing to a read-only mapping) æ˜ å°„åŒºåŸŸä¸­çš„ä¿æŠ¤æ•…éšœï¼ˆä¾‹å¦‚å†™å…¥åªè¯»æ˜ å°„ï¼‰</td></tr><tr><td>+2</td><td>write (instead of a read)</td></tr><tr><td>+4</td><td>user mode access (instead of kernel mode access)</td></tr><tr><td>+8</td><td>use of reserved bits in the page table entry detected (the kernel will panic if this happens) use of reserved bits in the page table entry detected (the kernel will panic if this happens)</td></tr><tr><td>+16 (+0x10)</td><td>fault was an instruction fetch, not data read or write</td></tr><tr><td>+32 (+0x20)</td><td>&lsquo;protection keys block access&rsquo; (don&rsquo;t ask me)</td></tr></tbody></table></div><p>Hex 0x14 is 0x10 + 4; (hex) 6 is 4 + 2. Error code 7 (0x7) is 4 + 2 + 1, a user-mode write to a read-only mapping, and is what you get if you attempt to write to a string constant in C:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>char *ex = &#34;example&#34;;
</span></span><span class=line><span class=cl>int main(int argc, char **argv) {
</span></span><span class=line><span class=cl>   *ex = &#39;E&#39;;
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>Compile and run this and you will get:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>a.out[8832]: segfault at 400540 ip 0000000000400499 sp 00007ffce6831490 error 7 in a.out[400000+1000]
</span></span></code></pre></td></tr></table></div></div><p>It appears that the program code always gets loaded at 0x400000 for ordinary programs, although I believe that shared libraries can have their location randomized.</p><p>PS: Per a comment in the kernel source, all accesses to addresses above the end of user space will be labeled as &lsquo;protection fault in a mapped area&rsquo; whether or not there are actual page table entries there. The kernel does this so you can&rsquo;t work out where its memory pages are by looking at the error code.</p><p>(I believe that user space normally ends around 0x07fffffffffff, per mm.txt, although see the comments about TASK_SIZE_MAX in processor.h and also page_64_types.h.) .</p></section><footer class=article-footer><section class=article-tags><a href=/tags/linux/>Linux</a>
<a href=/tags/%E5%86%85%E6%A0%B8/>å†…æ ¸</a>
<a href=/tags/avx512/>AVX512</a>
<a href=/tags/%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5/>æ•…éšœæ’æŸ¥</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/linux-nvidia-%E9%80%A0%E6%88%90-kernel-crash/><div class=article-details><h2 class=article-title>Linux - NVIDIA é€ æˆ kernel crash</h2></div></a></article><article><a href=/p/process-scheduling-in-linux/><div class=article-details><h2 class=article-title>Process Scheduling In Linux</h2></div></a></article><article><a href=/p/ssh-key-%E7%94%9F%E6%88%90/><div class=article-details><h2 class=article-title>SSH key ç”Ÿæˆ</h2></div></a></article><article><a href=/p/ack-command/><div class=article-details><h2 class=article-title>Ack command</h2></div></a></article><article><a href=/p/hi-linux-shell/><div class=article-details><h2 class=article-title>Hi, Linux shell</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//weasley.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 Kunkka</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>