<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="\n背景 业务中碰到一个场景，服务需要处理一个Job，分为几个阶段：Pre Do After。实现业务逻辑有两种比较常见的模式:\n线程池 事件驱动 那这两种模式孰优孰劣？看看前人的见解：\nEventDriven-oriented or Procedure-oriented Who are they Event Driven 相对较小的进程数量，进程之间进行显式消息通信。针对于事件驱动，有多种实现形式，例如观察者模式或者发布订阅模式等。\n1 2 3 1. Small number of (relatively static) big processes 2. Explicit set of message channels 3. Limited amount of direct sharing of data in memory 观察者模式\n"><title>事件驱动 or 面向过程</title><link rel=canonical href=https://MyLoveES.github.io/p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="事件驱动 or 面向过程"><meta property='og:description' content="\n背景 业务中碰到一个场景，服务需要处理一个Job，分为几个阶段：Pre Do After。实现业务逻辑有两种比较常见的模式:\n线程池 事件驱动 那这两种模式孰优孰劣？看看前人的见解：\nEventDriven-oriented or Procedure-oriented Who are they Event Driven 相对较小的进程数量，进程之间进行显式消息通信。针对于事件驱动，有多种实现形式，例如观察者模式或者发布订阅模式等。\n1 2 3 1. Small number of (relatively static) big processes 2. Explicit set of message channels 3. Limited amount of direct sharing of data in memory 观察者模式\n"><meta property='og:url' content='https://MyLoveES.github.io/p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/'><meta property='og:site_name' content='Kunkka'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='架构'><meta property='article:tag' content='事件驱动'><meta property='article:tag' content='理论'><meta property='article:published_time' content='2022-03-21T00:00:00+00:00'><meta property='article:modified_time' content='2022-03-21T00:00:00+00:00'><meta name=twitter:title content="事件驱动 or 面向过程"><meta name=twitter:description content="\n背景 业务中碰到一个场景，服务需要处理一个Job，分为几个阶段：Pre Do After。实现业务逻辑有两种比较常见的模式:\n线程池 事件驱动 那这两种模式孰优孰劣？看看前人的见解：\nEventDriven-oriented or Procedure-oriented Who are they Event Driven 相对较小的进程数量，进程之间进行显式消息通信。针对于事件驱动，有多种实现形式，例如观察者模式或者发布订阅模式等。\n1 2 3 1. Small number of (relatively static) big processes 2. Explicit set of message channels 3. Limited amount of direct sharing of data in memory 观察者模式\n"><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_c68a00bbf16dac8.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🍥</span></figure><div class=site-meta><h1 class=site-name><a href=/>Kunkka</a></h1><h2 class=site-description>wind rises</h2></div></header><ol class=menu-social><li><a href=https://github.com/MyLoveES target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=/index.xml target=_blank title=RSS rel=me><svg class="icon icon-tabler icon-tabler-rss" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="5" cy="19" r="1"/><path d="M4 4a16 16 0 0116 16"/><path d="M4 11a9 9 0 019 9"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/about><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span></a></li><li><a href=/archives><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/all-categories><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg>
<span>Categories</span></a></li><li><a href=/links><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li><a href=/all-tags><svg class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11 3l9 9a1.5 1.5.0 010 2l-6 6a1.5 1.5.0 01-2 0L3 11V7a4 4 0 014-4h4"/><circle cx="9" cy="9" r="2"/></svg>
<span>Tags</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#who-are-they>Who are they</a><ol><li><a href=#event-driven>Event Driven</a></li><li><a href=#procedure-oriented>Procedure-oriented</a></li></ol></li><li><a href=#the-duality-mapping>The Duality Mapping</a><ol><li><a href=#event-driven-simpler-concurrency-model>Event Driven: simpler concurrency model</a><ol><li><a href=#一些概念的定义>一些概念的定义：</a></li><li><a href=#运行公式>运行公式</a></li></ol></li><li><a href=#procedure-oriented-simpler--natural-programming-style>Procedure-oriented: simpler & natural programming style</a><ol><li><a href=#一些概念的定义-1>一些概念的定义</a></li><li><a href=#运行公式-1>运行公式</a></li></ol></li><li><a href=#the-duality-mapping-1>The Duality Mapping</a><ol><li><a href=#番外>番外</a></li></ol></li><li><a href=#性能>性能</a></li></ol></li><li><a href=#but-who-is-better->But, who is better ?</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/%E6%8A%80%E6%9C%AF/>技术</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/>事件驱动 or 面向过程</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Mar 21, 2022</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>11 minute read</time></div></footer></div></header><section class=article-content><p><img src=/p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/funny_compare.png width=1400 height=770 srcset="/p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/funny_compare_hu_4cdf0406c8c108c8.png 480w, /p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/funny_compare_hu_1d43c3679bcdf975.png 1024w" loading=lazy class=gallery-image data-flex-grow=181 data-flex-basis=436px></p><h1 id=背景>背景</h1><p>业务中碰到一个场景，服务需要处理一个Job，分为几个阶段：Pre Do After。实现业务逻辑有两种比较常见的模式:</p><p>线程池
<img src=/p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/Procedure.png width=959 height=192 srcset="/p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/Procedure_hu_e90b1bc0403cfc4e.png 480w, /p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/Procedure_hu_9b5ded020d55e0e.png 1024w" loading=lazy class=gallery-image data-flex-grow=499 data-flex-basis=1198px></p><p>事件驱动
<img src=/p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/EventDrivenBack.png width=815 height=137 srcset="/p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/EventDrivenBack_hu_ab9aa5ce39888c5d.png 480w, /p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/EventDrivenBack_hu_ba012bb012ca3651.png 1024w" loading=lazy class=gallery-image data-flex-grow=594 data-flex-basis=1427px></p><p>那这两种模式孰优孰劣？看看前人的见解：</p><h1 id=eventdriven-oriented-or-procedure-oriented>EventDriven-oriented or Procedure-oriented</h1><h2 id=who-are-they>Who are they</h2><h3 id=event-driven>Event Driven</h3><p><img src=/p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/EventDriven-workers.png width=390 height=176 srcset="/p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/EventDriven-workers_hu_c11e05b94e24b167.png 480w, /p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/EventDriven-workers_hu_2d520c7c66ba93a8.png 1024w" loading=lazy class=gallery-image data-flex-grow=221 data-flex-basis=531px></p><p><strong>相对</strong>较小的进程数量，进程之间进行显式消息通信。针对于事件驱动，有多种实现形式，例如观察者模式或者发布订阅模式等。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1. Small number of (relatively static) big processes
</span></span><span class=line><span class=cl>2. Explicit set of message channels
</span></span><span class=line><span class=cl>3. Limited amount of direct sharing of data in memory
</span></span></code></pre></td></tr></table></div></div><ul><li><p>观察者模式<br><img src=/p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/Observer.png width=493 height=526 srcset="/p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/Observer_hu_8df7b65a1e4b6ca5.png 480w, /p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/Observer_hu_f5cab1a05046fa24.png 1024w" loading=lazy class=gallery-image data-flex-grow=93 data-flex-basis=224px></p></li><li><p>发布订阅模式
<img src=/p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/Publisher-Subscriber.png width=640 height=344 srcset="/p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/Publisher-Subscriber_hu_f105db320ffec191.png 480w, /p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/Publisher-Subscriber_hu_9983713b7f1be770.png 1024w" loading=lazy class=gallery-image data-flex-grow=186 data-flex-basis=446px></p></li></ul><p>它的特点是事件的产生者并不关心具体的处理逻辑，每个环节的workers都能够专注于自己的工作</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>事件驱动的优点：
</span></span><span class=line><span class=cl>1. 解耦：事件发布者、订阅者解耦，其中一个环节的变化，不会影响其他环境的进行
</span></span><span class=line><span class=cl>2. 异步：各个环节通过事件关联，所以服务间不会block。带来执行的可调度性，资源分配的动态性
</span></span><span class=line><span class=cl>3. 灵活：在服务间增加一些适配器（如日志、认证、版本、限流、降级、熔断等）相当容易
</span></span><span class=line><span class=cl>4. 独立：服务间的吞吐也被解开了，各个服务可以专注于自己的实现，按照自己的处理速度处理
</span></span><span class=line><span class=cl>5. 缓冲：利用 Broker 或队列的方式还可以达到把抖动的吞吐量变成均匀的吞吐量，这就是所谓的“削峰”，这对后端系统是个不错的保护
</span></span></code></pre></td></tr></table></div></div><h3 id=procedure-oriented>Procedure-oriented</h3><p><img src=/p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/Procedure.png width=959 height=192 srcset="/p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/Procedure_hu_e90b1bc0403cfc4e.png 480w, /p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/Procedure_hu_9b5ded020d55e0e.png 1024w" loading=lazy class=gallery-image data-flex-grow=499 data-flex-basis=1198px></p><p>大量快速变化的小进程和基于共享数据的进程同步机制<br>它的特点是一次请求从一而终，由单一的线程（进程）执行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1. Large number of very small processes
</span></span><span class=line><span class=cl>2. Rapid creation and deletion of processes
</span></span><span class=line><span class=cl>3. Communication by means of direct sharing of
</span></span><span class=line><span class=cl>data in memory
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>面向过程的优点：
</span></span><span class=line><span class=cl>1. 架构简单明了，易于实现
</span></span><span class=line><span class=cl>2. 各环节在在同一线程/进程内完成，易于追踪(debug)
</span></span><span class=line><span class=cl>3. 实时性强，任务从一而终
</span></span></code></pre></td></tr></table></div></div><h2 id=the-duality-mapping>The Duality Mapping</h2><p><img src=/p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/MessageEqualsThread.png width=776 height=477 srcset="/p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/MessageEqualsThread_hu_6a944a6313417065.png 480w, /p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/MessageEqualsThread_hu_5f038677b6f137b8.png 1024w" loading=lazy class=gallery-image data-flex-grow=162 data-flex-basis=390px></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>&lt;</span><span class=n>On</span> <span class=n>the</span> <span class=n>Duality</span> <span class=n>of</span> <span class=n>Operating</span> <span class=n>System</span> <span class=n>Structures</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=mf>1.</span> <span class=n>The</span> <span class=n>two</span> <span class=n>models</span> <span class=n>are</span> <span class=n>duals</span> <span class=n>of</span> <span class=n>each</span> <span class=n>other</span><span class=o>.</span> <span class=n>That</span> <span class=n>is</span><span class=p>,</span> <span class=n>a</span> <span class=n>program</span> <span class=ow>or</span> <span class=n>subsystem</span> <span class=n>constructed</span> <span class=n>strictly</span> <span class=n>according</span> <span class=n>to</span> <span class=n>the</span> <span class=n>primitives</span> <span class=n>defined</span> <span class=n>by</span> <span class=n>one</span> <span class=n>model</span> <span class=n>can</span> <span class=n>be</span> <span class=n>mapped</span> <span class=n>directly</span> <span class=n>into</span> <span class=n>a</span> <span class=n>dual</span> <span class=n>program</span> <span class=ow>or</span> <span class=n>subsystem</span> <span class=n>which</span> <span class=n>fits</span> <span class=n>the</span> <span class=n>other</span> <span class=n>model</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=mf>2.</span> <span class=n>The</span> <span class=n>dual</span> <span class=n>programs</span> <span class=ow>or</span> <span class=n>subsystems</span> <span class=n>are</span> <span class=n>logically</span> <span class=n>identical</span> <span class=n>to</span> <span class=n>each</span> <span class=n>other</span><span class=o>.</span> <span class=n>They</span> <span class=n>can</span> <span class=n>also</span> <span class=n>be</span> <span class=n>made</span> <span class=n>textually</span> <span class=n>very</span> <span class=n>similar</span><span class=p>,</span> <span class=n>differing</span> <span class=n>only</span> <span class=ow>in</span> <span class=n>non</span><span class=o>-</span><span class=n>essential</span> <span class=n>details</span><span class=o>.</span>
</span></span><span class=line><span class=cl><span class=mf>3.</span> <span class=n>The</span> <span class=n>performance</span> <span class=n>of</span> <span class=n>a</span> <span class=n>program</span> <span class=ow>or</span> <span class=n>subsystem</span> <span class=n>from</span> <span class=n>one</span> <span class=n>model</span><span class=p>,</span> <span class=n>as</span> <span class=n>reflected</span> <span class=n>by</span> <span class=n>its</span> <span class=n>queue</span> <span class=n>lengths</span><span class=p>,</span> <span class=n>waiting</span> <span class=n>times</span><span class=p>,</span> <span class=n>service</span> <span class=n>rates</span><span class=p>,</span> <span class=n>etc</span><span class=o>.</span> <span class=n>is</span> <span class=n>identical</span> <span class=n>to</span> <span class=n>that</span> <span class=n>of</span> <span class=n>its</span> <span class=n>dual</span> <span class=n>system</span><span class=p>,</span> <span class=n>given</span> <span class=n>identical</span> <span class=n>scheduling</span> <span class=n>strategies</span><span class=o>.</span> <span class=n>Furthermore</span><span class=p>,</span> <span class=n>the</span> <span class=n>primitive</span> <span class=n>operations</span> <span class=n>provided</span> <span class=n>by</span> <span class=n>the</span> <span class=n>operating</span> <span class=n>system</span> <span class=n>of</span> <span class=n>one</span> <span class=n>model</span> <span class=n>can</span> <span class=n>be</span> <span class=n>made</span> <span class=n>as</span> <span class=n>efficient</span> <span class=n>as</span> <span class=n>their</span> <span class=n>duals</span> <span class=n>of</span> <span class=n>the</span> <span class=n>other</span> <span class=n>model</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>1.</span> <span class=err>两类模型互为对偶，两者可以互相转换。</span>
</span></span><span class=line><span class=cl><span class=mf>2.</span> <span class=err>逻辑上两者彼此相似，甚至可以在文本上表现得非常相似，除了非必要的细节上。</span>
</span></span><span class=line><span class=cl><span class=mf>3.</span> <span class=err>在相同的调度策略下，两类模型的性能可以一样高（根据队列长度、等待时间、处理速度等方面观测）。除此之外，一个模型提供的基本操作可以使其效率和另一个模型一样高。</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=event-driven-simpler-concurrency-model>Event Driven: simpler concurrency model</h3><details><summary>原文</summary><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Messages and message identifiers. A message is a data structure meant for sending information from one process to another; it typically contains a small, fixed area for data which is passed by value and space for a pointer to larger data structures which must be passed by reference. A message identifier is a handle by which a particular message can be identified.
</span></span><span class=line><span class=cl>Message channels and message ports. A message channel is an abstract structure which identifies the destination of a message. A message port is queue capable of holding messages of a certain class or type which might be received by a particular process. Each message channel must be bound to a particular message port before is can be used. A message port, however, may have more than one message channel bound to it.
</span></span><span class=line><span class=cl>Four message transmission operations:
</span></span><span class=line><span class=cl>    1. SendMessage[messageChannel, messageBody] returns [messageId] 
</span></span><span class=line><span class=cl>       This operation simply queues a new message on the port bound to the the messageChannel named as parameter. 
</span></span><span class=line><span class=cl>       The messageld returned is used as parameter to the following operation.
</span></span><span class=line><span class=cl>    2. AwaitReply(messageId] returns [messageBody] 
</span></span><span class=line><span class=cl>       The operation causes the process to wait for a reply to a specific message previously sent via SendMessage.
</span></span><span class=line><span class=cl>    3. WaitForMessage[set of messagePort] returns [messageBody, messageld, messagePort] 
</span></span><span class=line><span class=cl>       This operation allows a process to wait for a new (unsolicited) message on any one of the message ports named in the &#39;parameter. 
</span></span><span class=line><span class=cl>       The message which is first on the queue is returned, along with a message identifier for future reference and an indication of the port from which that message came.
</span></span><span class=line><span class=cl>    4. SendReply[messageId, messageBody]
</span></span><span class=line><span class=cl>       This operation sends a reply to the particular message identified by the message identifier.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>SKIP FIGURE
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>In this process, the kind of service requested is a function of which port the requesting message arrives on. It may or may not involve making requests of still other processes and/or sending a reply back to the requestor. It may also result in some circumstance, such as the exhaustion of a resource, which prevents further requests from being considered. These remain queued on their port until later, when the process is willing to listen on that port again.
</span></span><span class=line><span class=cl>Note that if a whole system is built according to this style, then the sole means of interaction among the components of that system is by means of the message facility. Each process can operate in its own address space without interference from the others. Because of the serial way in which requests are handled, there is never any need to protect the state information of a process from multiple, simultaneous access and updating.
</span></span></code></pre></td></tr></table></div></div></details><h4 id=一些概念的定义>一些概念的定义：</h4><blockquote><p>Messages: 数据结构，用于进程之间传递信息。<br>Message identifiers: 消息 id<br>Message channels: 消息目的地<br>Message ports: 接收端口</p></blockquote><blockquote><p>SendMessage [messageChannel, messageBody] returns [messageId]<br>AwaitReply [messageId] returns [messageBody]
WaitForMessage [set of messagePort] returns [messageBody, messageld, messagePort]
SendReply [messageId, messageBody]</p></blockquote><p><img src=/p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/MessageDefinition.png width=777 height=236 srcset="/p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/MessageDefinition_hu_cda856c528e6f3a8.png 480w, /p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/MessageDefinition_hu_16a9549f1d611b2e.png 1024w" loading=lazy class=gallery-image data-flex-grow=329 data-flex-basis=790px></p><h4 id=运行公式>运行公式</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>begin m: messageBody; 
</span></span><span class=line><span class=cl>    i: messageld;
</span></span><span class=line><span class=cl>    p: portid;
</span></span><span class=line><span class=cl>    s: set of portid;
</span></span><span class=line><span class=cl>    ... -local data and state information for this process
</span></span><span class=line><span class=cl>    initialize;
</span></span><span class=line><span class=cl>    do forever;
</span></span><span class=line><span class=cl>        [m, i, p] &lt;- WaitForMessage[s];
</span></span><span class=line><span class=cl>        case p of
</span></span><span class=line><span class=cl>            port1 =&gt;...; -algorithm for port1
</span></span><span class=line><span class=cl>            port2 =&gt;... 
</span></span><span class=line><span class=cl>                    if resourceExhausted then 
</span></span><span class=line><span class=cl>                        s &lt;- s - port2; 
</span></span><span class=line><span class=cl>                    SendReply[i, reply];
</span></span><span class=line><span class=cl>                    ...; -algorithm for port2
</span></span><span class=line><span class=cl>            portk =&gt;...
</span></span><span class=line><span class=cl>                    s &lt;- s + port2
</span></span><span class=line><span class=cl>                    ...; -algorithm for portk
</span></span><span class=line><span class=cl>        endcase; 
</span></span><span class=line><span class=cl>    endloop;
</span></span><span class=line><span class=cl>end.
</span></span></code></pre></td></tr></table></div></div><h3 id=procedure-oriented-simpler--natural-programming-style>Procedure-oriented: simpler & natural programming style</h3><details><summary>原文</summary><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=mf>1.</span> <span class=n>Procedures</span><span class=o>.</span> <span class=n>A</span> <span class=n>procedure</span> <span class=n>is</span> <span class=n>a</span> <span class=n>piece</span> <span class=n>of</span> <span class=n>Mesa</span> <span class=n>text</span> <span class=n>containing</span> <span class=n>algorithms</span><span class=p>,</span> <span class=n>local</span> <span class=n>data</span><span class=p>,</span> <span class=n>parameters</span><span class=p>,</span> <span class=ow>and</span> <span class=n>results</span><span class=o>.</span> <span class=n>It</span> <span class=n>always</span> <span class=n>operates</span> <span class=ow>in</span> <span class=n>the</span> <span class=n>scope</span> <span class=n>of</span> <span class=n>a</span> <span class=n>Mesa</span> <span class=n>module</span> <span class=ow>and</span> <span class=n>may</span> <span class=n>access</span> <span class=n>any</span> <span class=n>global</span> <span class=n>data</span> <span class=n>declared</span> <span class=ow>in</span> <span class=n>that</span> <span class=n>module</span> <span class=p>(</span><span class=n>as</span> <span class=n>well</span> <span class=n>as</span> <span class=ow>in</span> <span class=n>any</span> <span class=n>containing</span> <span class=n>procedures</span><span class=p>)</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>2.</span> <span class=n>Procedure</span> <span class=n>call</span> <span class=n>facilities</span><span class=p>,</span> <span class=n>synchronous</span> <span class=ow>and</span> <span class=n>asynchronous</span><span class=o>.</span> <span class=n>The</span> <span class=n>synchronous</span> <span class=n>procedure</span> <span class=n>call</span> <span class=n>mechanism</span> <span class=n>is</span> <span class=n>just</span> <span class=n>the</span> <span class=n>ordinary</span> <span class=n>Mesa</span> <span class=n>procedure</span> <span class=n>call</span> <span class=n>statement</span><span class=p>,</span> <span class=n>which</span> <span class=n>may</span> <span class=k>return</span> <span class=n>results</span><span class=o>.</span> <span class=n>This</span> <span class=n>is</span> <span class=n>very</span> <span class=n>much</span> <span class=n>like</span> <span class=n>procedure</span> <span class=ow>or</span> <span class=n>function</span> <span class=n>calls</span> <span class=ow>in</span> <span class=n>Algol</span><span class=p>,</span> <span class=n>Pascal</span><span class=p>,</span> <span class=n>etc</span><span class=o>.</span> <span class=n>The</span> <span class=n>asynchronous</span> <span class=n>procedure</span> <span class=n>call</span> <span class=n>mechanism</span> <span class=n>is</span> <span class=n>represented</span> <span class=n>by</span> <span class=n>the</span> <span class=n>FORK</span> <span class=ow>and</span> <span class=n>JOIN</span> <span class=n>statements</span><span class=p>,</span> <span class=n>which</span> <span class=n>are</span> <span class=n>defmed</span> <span class=n>as</span> <span class=n>follows</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=mi>1</span><span class=p>)</span> <span class=n>processld</span> <span class=o>&lt;-</span> <span class=n>FORK</span> <span class=n>procedureName</span><span class=p>[</span><span class=n>parameterList</span><span class=p>]</span> <span class=o>-</span> <span class=n>This</span> <span class=n>statement</span> <span class=n>starts</span> <span class=n>the</span> <span class=n>procedure</span> <span class=n>executing</span> <span class=n>as</span> <span class=n>a</span> <span class=n>new</span> <span class=n>process</span> <span class=n>with</span> <span class=n>its</span> <span class=n>own</span> <span class=n>parameters</span><span class=o>.</span> <span class=n>The</span> <span class=n>procedure</span> <span class=n>operates</span> <span class=ow>in</span> <span class=n>the</span> <span class=n>context</span> <span class=n>of</span> <span class=n>its</span> <span class=n>declaration</span><span class=p>,</span> <span class=n>just</span> <span class=n>as</span> <span class=k>if</span> <span class=n>it</span> <span class=n>had</span> <span class=n>been</span> <span class=n>called</span> <span class=n>synchronously</span><span class=p>,</span> <span class=n>but</span> <span class=n>the</span> <span class=n>process</span> <span class=n>has</span> <span class=n>its</span> <span class=n>own</span> <span class=n>call</span> <span class=n>stack</span> <span class=ow>and</span> <span class=n>state</span><span class=o>.</span> <span class=n>The</span> <span class=n>calling</span> <span class=n>process</span> <span class=n>continues</span> <span class=n>executing</span> <span class=n>from</span> <span class=n>the</span> <span class=n>statement</span> <span class=n>following</span> <span class=n>the</span> <span class=n>FORK</span><span class=o>.</span> <span class=n>The</span> <span class=n>process</span> <span class=n>identifier</span> <span class=n>returned</span> <span class=n>from</span> <span class=n>FORK</span> <span class=n>is</span> <span class=n>used</span> <span class=ow>in</span> <span class=n>the</span> <span class=n>next</span> <span class=n>statement</span>
</span></span><span class=line><span class=cl>    <span class=mi>2</span><span class=p>)</span> <span class=p>[</span><span class=n>resultList</span><span class=p>]</span> <span class=o>&lt;-</span> <span class=n>JOIN</span> <span class=n>processld</span> <span class=o>-</span> <span class=n>This</span> <span class=n>statement</span> <span class=n>causes</span> <span class=n>the</span> <span class=n>process</span> <span class=n>executing</span> <span class=n>it</span> <span class=n>to</span> <span class=n>synchronize</span> <span class=n>itself</span> <span class=n>with</span> <span class=n>the</span> <span class=n>termination</span> <span class=n>of</span> <span class=n>the</span> <span class=n>process</span> <span class=n>named</span> <span class=n>by</span> <span class=n>the</span> <span class=n>process</span> <span class=n>identifier</span><span class=o>.</span> <span class=n>The</span> <span class=n>results</span> <span class=n>are</span> <span class=n>retrieved</span> <span class=n>from</span> <span class=n>that</span> <span class=n>process</span> <span class=ow>and</span> <span class=n>returned</span> <span class=n>to</span> <span class=n>the</span> <span class=n>calling</span> <span class=n>process</span> <span class=n>as</span> <span class=k>if</span> <span class=n>they</span> <span class=n>had</span> <span class=n>been</span> <span class=n>returned</span> <span class=n>from</span> <span class=n>an</span> <span class=n>ordinary</span> <span class=n>procedure</span> <span class=n>call</span><span class=o>.</span> <span class=n>The</span> <span class=n>JOlNed</span> <span class=n>process</span> <span class=n>is</span> <span class=n>then</span> <span class=n>destroyed</span> <span class=ow>and</span> <span class=n>execution</span> <span class=n>continues</span> <span class=ow>in</span> <span class=n>the</span> <span class=n>JOlNing</span> <span class=n>process</span> <span class=n>from</span> <span class=n>the</span> <span class=n>statement</span> <span class=n>following</span> <span class=n>the</span> <span class=n>JOIN</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>3.</span> <span class=n>Modules</span> <span class=ow>and</span> <span class=n>monitors</span><span class=o>.</span> <span class=n>A</span> <span class=n>module</span> <span class=n>is</span> <span class=n>the</span> <span class=n>primitive</span> <span class=n>Mesa</span> <span class=n>unit</span> <span class=n>of</span> <span class=n>compilation</span> <span class=ow>and</span> <span class=n>consists</span> <span class=n>of</span> <span class=n>a</span> <span class=n>collection</span> <span class=n>of</span> <span class=n>procedures</span> <span class=ow>and</span> <span class=n>data</span><span class=o>.</span> <span class=n>The</span> <span class=n>scope</span> <span class=n>rules</span> <span class=n>of</span> <span class=n>the</span> <span class=n>language</span> <span class=n>determine</span> <span class=n>which</span> <span class=n>of</span> <span class=n>these</span><span class=o>.</span> <span class=n>procedures</span> <span class=ow>and</span> <span class=n>data</span> <span class=n>are</span> <span class=n>accessible</span> <span class=ow>or</span> <span class=n>callable</span> <span class=n>from</span> <span class=n>outside</span> <span class=n>the</span> <span class=n>module</span><span class=o>.</span> <span class=n>A</span> <span class=n>monitor</span> <span class=n>is</span> <span class=n>a</span> <span class=n>special</span> <span class=n>kind</span> <span class=n>of</span> <span class=n>Mesa</span> <span class=n>module</span> <span class=n>which</span> <span class=n>has</span> <span class=n>associated</span> <span class=n>with</span> <span class=n>it</span> <span class=n>a</span> <span class=n>lock</span> <span class=n>to</span> <span class=n>prevent</span> <span class=n>more</span> <span class=n>than</span> <span class=n>one</span> <span class=n>process</span> <span class=n>from</span> <span class=n>executing</span> <span class=n>inside</span> <span class=n>of</span> <span class=n>it</span> <span class=n>at</span> <span class=n>any</span> <span class=n>one</span> <span class=n>time</span><span class=o>.</span> <span class=n>It</span> <span class=n>is</span> <span class=n>based</span> <span class=n>on</span> <span class=ow>and</span> <span class=n>very</span> <span class=n>similar</span> <span class=n>to</span> <span class=n>the</span> <span class=n>monitor</span> <span class=n>mechanism</span> <span class=n>described</span> <span class=n>by</span> <span class=n>Hoare</span><span class=p>[</span><span class=mi>6</span><span class=p>]</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>4.</span> <span class=n>Module</span> <span class=n>instantiation</span><span class=o>.</span> <span class=n>Modules</span> <span class=p>(</span><span class=n>including</span> <span class=n>monitor</span> <span class=n>modules</span><span class=p>)</span> <span class=n>may</span> <span class=n>be</span> <span class=n>instantiated</span> <span class=ow>in</span> <span class=n>Mesa</span> <span class=n>by</span> <span class=n>means</span> <span class=n>of</span> <span class=n>the</span> <span class=n>NEW</span> <span class=ow>and</span> <span class=n>START</span> <span class=n>statements</span><span class=o>.</span> <span class=n>These</span> <span class=n>cause</span> <span class=n>a</span> <span class=n>new</span> <span class=n>context</span> <span class=n>to</span> <span class=n>be</span> <span class=n>created</span> <span class=k>for</span> <span class=n>holding</span> <span class=n>the</span> <span class=n>module</span> <span class=n>data</span><span class=p>,</span> <span class=n>provide</span> <span class=n>the</span> <span class=n>binding</span> <span class=n>from</span> <span class=n>external</span> <span class=n>procedure</span> <span class=n>references</span> <span class=n>within</span> <span class=n>the</span> <span class=n>module</span> <span class=n>to</span> <span class=n>procedures</span> <span class=n>declared</span> <span class=ow>in</span> <span class=n>other</span> <span class=n>modules</span><span class=p>,</span> <span class=ow>and</span> <span class=n>activate</span> <span class=n>the</span> <span class=n>initialization</span> <span class=n>code</span> <span class=n>of</span> <span class=n>the</span> <span class=n>module</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=mf>5.</span> <span class=n>Condition</span> <span class=n>variables</span><span class=o>.</span> <span class=n>Condition</span> <span class=n>variables</span> <span class=n>are</span> <span class=n>part</span> <span class=n>of</span> <span class=n>Hoare</span><span class=s1>&#39;s monitor mechanism an provide more flexible synchronization among events than mutual exclusion facility of the monitor lock or the process termination facility of the JOIN statement. In our model, a condition variable, must be contained within a monitor, has associated with it a queue of processes, and has two operations defined on it:</span>
</span></span><span class=line><span class=cl>    <span class=mi>1</span><span class=p>)</span> <span class=n>WAIT</span> <span class=n>conditionVariable</span> <span class=o>-</span> <span class=n>This</span> <span class=n>causes</span> <span class=n>the</span> <span class=n>process</span> <span class=n>executing</span> <span class=n>it</span> <span class=n>to</span> <span class=n>release</span> <span class=n>the</span> <span class=n>monitor</span> <span class=n>lock</span><span class=p>,</span> <span class=n>suspend</span> <span class=n>execution</span><span class=p>,</span> <span class=ow>and</span> <span class=n>join</span> <span class=n>the</span> <span class=n>queue</span> <span class=n>associated</span> <span class=n>with</span> <span class=n>that</span> <span class=n>condition</span> <span class=n>variable</span><span class=o>.</span>
</span></span><span class=line><span class=cl>    <span class=mi>2</span><span class=p>)</span> <span class=n>SIGNAL</span> <span class=n>condition</span> <span class=n>Variable</span> <span class=o>--</span> <span class=n>This</span> <span class=n>causes</span> <span class=n>a</span> <span class=n>process</span> <span class=n>which</span> <span class=n>has</span> <span class=n>previously</span> <span class=n>WAITed</span> <span class=n>on</span> <span class=n>the</span> <span class=n>condition</span> <span class=n>variable</span> <span class=n>to</span> <span class=n>resume</span> <span class=n>execution</span> <span class=n>from</span> <span class=n>its</span> <span class=n>next</span> <span class=n>statement</span> <span class=n>when</span> <span class=n>it</span> <span class=n>is</span> <span class=n>able</span> <span class=n>to</span> <span class=n>reclaim</span> <span class=n>the</span> <span class=n>monitor</span> <span class=n>lock</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Note</span> <span class=n>that</span> <span class=n>because</span> <span class=n>the</span> <span class=n>FORK</span> <span class=ow>and</span> <span class=n>JOIN</span> <span class=n>operations</span> <span class=n>apply</span> <span class=n>to</span> <span class=n>procedures</span> <span class=n>which</span> <span class=n>are</span> <span class=n>already</span> <span class=n>declared</span> <span class=ow>and</span> <span class=n>bound</span> <span class=n>to</span> <span class=n>the</span> <span class=n>right</span> <span class=n>context</span><span class=p>,</span> <span class=n>these</span> <span class=n>operations</span> <span class=n>take</span> <span class=n>the</span> <span class=n>same</span> <span class=n>order</span> <span class=n>of</span> <span class=n>magnitude</span> <span class=n>of</span> <span class=n>time</span> <span class=n>to</span> <span class=n>execute</span> <span class=n>as</span> <span class=k>do</span> <span class=n>simple</span> <span class=n>procedure</span> <span class=n>calls</span> <span class=ow>and</span> <span class=n>returns</span><span class=o>.</span> <span class=n>Thus</span> <span class=n>processes</span> <span class=n>are</span> <span class=n>very</span> <span class=n>lightweight</span><span class=p>,</span> <span class=ow>and</span> <span class=n>can</span> <span class=n>be</span> <span class=n>created</span> <span class=ow>and</span> <span class=n>destroyed</span> <span class=n>very</span> <span class=n>frequently</span><span class=o>.</span> <span class=n>Module</span> <span class=ow>and</span> <span class=n>monitor</span> <span class=n>instantiation</span><span class=p>,</span> <span class=n>on</span> <span class=n>the</span> <span class=n>other</span> <span class=n>hand</span><span class=p>,</span> <span class=n>is</span> <span class=n>more</span> <span class=n>cumbersome</span> <span class=ow>and</span> <span class=n>is</span> <span class=n>usually</span> <span class=n>done</span> <span class=n>statically</span> <span class=n>before</span> <span class=n>the</span> <span class=n>system</span> <span class=n>is</span> <span class=n>started</span><span class=o>.</span> <span class=n>Note</span> <span class=n>that</span> <span class=n>this</span> <span class=n>canonical</span> <span class=n>model</span> <span class=n>has</span> <span class=n>no</span> <span class=n>module</span> <span class=n>deletion</span> <span class=n>facility</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>SKIP</span> <span class=n>FIGURE</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>The</span> <span class=n>attribute</span> <span class=n>ENTRY</span> <span class=n>is</span> <span class=n>used</span> <span class=n>to</span> <span class=n>distinguish</span> <span class=n>procedures</span> <span class=n>which</span> <span class=n>are</span> <span class=n>called</span> <span class=n>from</span> <span class=n>outside</span> <span class=n>the</span> <span class=n>monitor</span><span class=p>,</span> <span class=n>thus</span> <span class=n>seizing</span> <span class=n>the</span> <span class=n>monitor</span> <span class=n>lock</span><span class=p>,</span> <span class=n>from</span> <span class=n>those</span> <span class=n>which</span> <span class=n>are</span> <span class=n>declared</span> <span class=n>purely</span> <span class=n>internal</span> <span class=n>to</span> <span class=n>the</span> <span class=n>monitor</span><span class=o>.</span> <span class=n>Any</span> <span class=n>of</span> <span class=n>the</span> <span class=n>procedures</span> <span class=ow>in</span> <span class=n>this</span> <span class=n>module</span> <span class=n>may</span><span class=p>,</span> <span class=n>of</span> <span class=n>course</span><span class=p>,</span> <span class=n>call</span> <span class=n>procedures</span> <span class=n>declared</span> <span class=ow>in</span> <span class=n>other</span> <span class=n>modules</span> <span class=k>for</span> <span class=n>other</span> <span class=n>system</span> <span class=n>services</span> <span class=n>before</span> <span class=n>returning</span><span class=o>.</span> <span class=n>Within</span> <span class=n>the</span> <span class=n>monitor</span><span class=p>,</span> <span class=n>condition</span> <span class=n>variables</span> <span class=n>are</span> <span class=n>used</span> <span class=n>to</span> <span class=n>control</span> <span class=n>waiting</span> <span class=k>for</span> <span class=n>circumstances</span> <span class=n>such</span> <span class=n>as</span> <span class=n>the</span> <span class=n>availability</span> <span class=n>of</span> <span class=n>resources</span><span class=o>.</span> <span class=n>These</span> <span class=n>are</span> <span class=n>used</span> <span class=ow>in</span> <span class=n>this</span> <span class=n>standard</span> <span class=n>resource</span> <span class=n>manager</span> <span class=p>,</span><span class=n>tp</span> <span class=n>control</span> <span class=n>the</span> <span class=n>access</span> <span class=n>of</span> <span class=n>a</span> <span class=n>process</span> <span class=n>the</span> <span class=n>procedure</span> <span class=n>representing</span> <span class=n>a</span> <span class=n>particular</span> <span class=n>kind</span> <span class=n>of</span> <span class=n>service</span><span class=o>.</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>If</span> <span class=n>a</span> <span class=n>whole</span> <span class=n>system</span> <span class=n>is</span> <span class=n>built</span> <span class=ow>in</span> <span class=n>this</span> <span class=n>style</span><span class=p>,</span> <span class=n>then</span> <span class=n>the</span> <span class=n>sole</span> <span class=n>means</span> <span class=n>of</span> <span class=n>interaction</span> <span class=n>among</span> <span class=n>its</span> <span class=n>components</span> <span class=n>is</span> <span class=n>procedural</span><span class=o>.</span> <span class=n>Processes</span> <span class=n>move</span> <span class=n>from</span> <span class=n>one</span> <span class=n>context</span> <span class=n>to</span> <span class=n>another</span> <span class=n>by</span> <span class=n>means</span> <span class=n>of</span> <span class=n>the</span> <span class=n>procedure</span> <span class=n>call</span> <span class=n>facility</span> <span class=n>across</span> <span class=n>module</span> <span class=n>boundaries</span><span class=p>,</span> <span class=ow>and</span> <span class=n>they</span> <span class=n>use</span> <span class=n>asynchronous</span> <span class=n>calls</span> <span class=n>to</span> <span class=n>stimulate</span> <span class=n>concurrent</span> <span class=n>activity</span><span class=o>.</span> <span class=n>They</span> <span class=n>depend</span> <span class=n>upon</span> <span class=n>monitor</span> <span class=n>locks</span> <span class=ow>and</span> <span class=n>condition</span> <span class=n>variables</span> <span class=n>to</span> <span class=n>keep</span> <span class=n>out</span> <span class=n>of</span> <span class=n>the</span> <span class=n>way</span> <span class=n>of</span> <span class=n>each</span> <span class=n>other</span><span class=o>.</span> <span class=n>Thus</span> <span class=n>no</span> <span class=n>process</span> <span class=n>can</span> <span class=n>be</span> <span class=n>associated</span> <span class=n>with</span> <span class=n>a</span> <span class=n>single</span> <span class=n>address</span> <span class=n>space</span> <span class=n>unless</span> <span class=n>that</span> <span class=n>space</span> <span class=n>be</span> <span class=n>the</span> <span class=n>whole</span> <span class=n>system</span><span class=o>.</span>
</span></span></code></pre></td></tr></table></div></div></details><h4 id=一些概念的定义-1>一些概念的定义</h4><blockquote><p>Procedure<br>Procedure call facilities, synchronous and asynchronous<br>&ndash; (asynchronous):<br>&mdash;- processld &lt;- FORK procedureName[parameterList]<br>&mdash;- [resultList] &lt;- JOIN processld<br>Modules: consists of a collection of procedures and data<br>Monitors: 监控锁防止多进程在其中执行<br>Module instantiation: 实例化<br>Condition variables:<br>&ndash; WAIT condition Variable<br>&ndash; SIGNAL condition Variable</p></blockquote><h4 id=运行公式-1>运行公式</h4><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ResourceManager: MONITOR =
</span></span><span class=line><span class=cl>    C: CONDITION;
</span></span><span class=line><span class=cl>    resourceExhausted: BOOLEAN;
</span></span><span class=line><span class=cl>    ... -global data and state information for this process
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    proc1: ENTRY PROCEDURE[...] =
</span></span><span class=line><span class=cl>           ...; -algorithm for prod
</span></span><span class=line><span class=cl>    proc2: ENTRY PROCEDURE[...] RETURNS[...] = 
</span></span><span class=line><span class=cl>           BEGIN
</span></span><span class=line><span class=cl>                IF resourceExhausted THEN WAIT c;
</span></span><span class=line><span class=cl>                •••;
</span></span><span class=line><span class=cl>                RETURN[results]; 
</span></span><span class=line><span class=cl>                •••;
</span></span><span class=line><span class=cl>                END; -algorithm for proc2
</span></span><span class=line><span class=cl>    procL: ENTRY PROCEDURE[...] = 
</span></span><span class=line><span class=cl>           BEGIN
</span></span><span class=line><span class=cl>                resourceExhausted &lt;- FALSE; 
</span></span><span class=line><span class=cl>                SIGNAL C;
</span></span><span class=line><span class=cl>                ...;
</span></span><span class=line><span class=cl>           END; -algorithm for procL endloop;
</span></span><span class=line><span class=cl>    endloop;
</span></span><span class=line><span class=cl>    initialize;
</span></span><span class=line><span class=cl>END
</span></span></code></pre></td></tr></table></div></div><h3 id=the-duality-mapping-1>The Duality Mapping</h3><div class=table-wrapper><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>Processes, CreateProcess</td><td>Monitors, NEW/START</td></tr><tr><td>Message Channels</td><td>External Procedure identifiers</td></tr><tr><td>Message Ports</td><td>ENTRY procedure identifier</td></tr><tr><td>SendMessage; AwaitReply (immediate)</td><td>simple procedure call</td></tr><tr><td>SendMessage; AwaitReply (delayed)</td><td>fork;join</td></tr><tr><td>SendReply</td><td>RETURN (from procedure)</td></tr><tr><td>main loop of standard resource manager, WaitForMessage statement, case statement</td><td>monitor lock, ENTRY attribute</td></tr><tr><td>arms of the case statement</td><td>ENTRY procedure declaration</td></tr><tr><td>selective waiting for messages</td><td>condition variables, WAIT, SIGNAL</td></tr></tbody></table></div><p><img src=/p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/DualityMappingServers.png width=912 height=465 srcset="/p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/DualityMappingServers_hu_a6817f47d7805267.png 480w, /p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/DualityMappingServers_hu_18767011346240d2.png 1024w" loading=lazy class=gallery-image data-flex-grow=196 data-flex-basis=470px>
<img src=/p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/DualityMappingClients.png width=885 height=458 srcset="/p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/DualityMappingClients_hu_1f6a53dc96926f4f.png 480w, /p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/DualityMappingClients_hu_b98f4620001e6896.png 1024w" loading=lazy class=gallery-image data-flex-grow=193 data-flex-basis=463px>
<img src=/p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/DualityMappingCodes.png width=913 height=473 srcset="/p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/DualityMappingCodes_hu_cd284acfa380824b.png 480w, /p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/DualityMappingCodes_hu_3172d61bf18f7dd5.png 1024w" loading=lazy class=gallery-image data-flex-grow=193 data-flex-basis=463px></p><h4 id=番外>番外</h4><p>在之后的另一篇文章，Why Events Are A Bad Idea 里面，作者的解释性对比</p><div class=table-wrapper><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>event handlers</td><td>monitors</td></tr><tr><td>events accepted by a handler</td><td>functions exported by a module</td></tr><tr><td>SendMessage、AwaitReply</td><td>procedure call, or fork/join</td></tr><tr><td>SendReply</td><td>return from procedure</td></tr><tr><td>waiting for messages</td><td>waiting on condition variables</td></tr></tbody></table></div><h3 id=性能>性能</h3><ol><li>程序本身执行时间
<img src=/p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/DualityMappingCodes.png width=913 height=473 srcset="/p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/DualityMappingCodes_hu_cd284acfa380824b.png 480w, /p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/DualityMappingCodes_hu_3172d61bf18f7dd5.png 1024w" loading=lazy class=gallery-image data-flex-grow=193 data-flex-basis=463px></li><li>调用系统操作开销（可以理解为调用第三方开销？）
<img src=/p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/SystemCall.png width=519 height=247 srcset="/p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/SystemCall_hu_d8dd1674f2902b85.png 480w, /p/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8-or-%E9%9D%A2%E5%90%91%E8%BF%87%E7%A8%8B/SystemCall_hu_de6d54ff6c69bf88.png 1024w" loading=lazy class=gallery-image data-flex-grow=210 data-flex-basis=504px></li><li>队列等待时间（反映的是阻塞、资源竞争、调度策略）</li></ol><p>二元性变换使构成系统的程序主体不受影响。因此，所有的算法将以相同的速度计算，并且在每个数据结构中存储相同数量的信息。在每个系统中执行的代码数量相同。将执行相同数量的加法、乘法、比较和字符串操作。因此，如果基本的处理器特性没有改变，那么这些特性将需要相同数量的计算能力，并且系统性能的这个组件将保持不变。同样，对于系统调用开销和队列阻塞等待，两者会付出同样的代价。</p><details><summary>原文</summary><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>The duality transformation leaves the main bodies of the programs comprising the system untouched. Thus the algorithms will all compute at the same speed, and the same amount of information will be stored in each data structure. The same amount of client code will be executed in each of the dual systems. The same number of additions, multiplications, comparisons, -and string operations will be performed. Therefore if basic processor characteristics are unchanged, then these will take precisely the same amount of computing power, and this component of the system performance will remain unchanged.
</span></span><span class=line><span class=cl>The other component affecting the speed of execution of a single program is the time it takes to execute each of the primitive system operations it calls. We assert without proof that the facilities of each of our two canonical models can be made to execute as efficiently as the corresponding facilities of the other model. I.e.,
</span></span><span class=line><span class=cl>Sending a message, with its inherent need to allocate a message block and manipulate a queue and its possibility of forcing a context (process) switch, is a computation of the same complexity as that of calling or FOR King to an ENTRY procedure, which involves the same need to allocate, queue, and force a context switch.
</span></span><span class=line><span class=cl>Leaving a monitor, with the possibility of having to unqueue a waiting process and re-enter it, is an operation of the same complexity as that of waiting for new messages.
</span></span><span class=line><span class=cl>Process switching can be made equally fast in either system, and for similar machine architectures this means saving the same amount of state information. The same is true for the scheduling and dispatching of processes at the &#39;microscopic&#39; level.
</span></span><span class=line><span class=cl>14
</span></span><span class=line><span class=cl>ON THE DUALITY OF OPERATING SYSTEM STRUCTURES
</span></span><span class=line><span class=cl>Virtual memory and paging or swapping can even be used with equal effectiveness in either model.
</span></span></code></pre></td></tr></table></div></div></details><h2 id=but-who-is-better->But, who is better ?</h2><blockquote><p>ref: <a class=link href=https://www.cc.gatech.edu/classes/AY2010/cs4210_fall/papers/ousterhout-threads.pdf target=_blank rel=noopener>Why Threads Are a Bad Idea</a>
ref: <a class=link href=http://capriccio.cs.berkeley.edu/pubs/threads-hotos-2003.pdf target=_blank rel=noopener>Why events are a bad idea</a></p></blockquote><h1 id=ref>Ref</h1><blockquote><p>ref: <a class=link href=https://courses.cs.vt.edu/~cs5204/fall07-gback/papers/p3-lauer.pdf target=_blank rel=noopener>On the Duality of Operating System Structures</a></p></blockquote></section><footer class=article-footer><section class=article-tags><a href=/tags/%E6%9E%B6%E6%9E%84/>架构</a>
<a href=/tags/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8/>事件驱动</a>
<a href=/tags/%E7%90%86%E8%AE%BA/>理论</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/why-events-are-a-bad-idea/><div class=article-details><h2 class=article-title>Why events are a bad idea</h2></div></a></article><article><a href=/p/why-reactor/><div class=article-details><h2 class=article-title>Why Reactor</h2></div></a></article><article><a href=/p/reaching-agreement-in-the-presence-of-faults/><div class=article-details><h2 class=article-title>Reaching agreement in the presence of faults</h2></div></a></article><article><a href=/p/%E6%8B%9C%E5%8D%A0%E5%BA%AD%E5%B0%86%E5%86%9B-%E5%8C%85%E5%90%AB%E6%81%B6%E6%84%8F%E8%8A%82%E7%82%B9%E7%9A%84%E5%85%B1%E8%AF%86%E9%97%AE%E9%A2%98/><div class=article-details><h2 class=article-title>拜占庭将军 - 包含恶意节点的共识问题</h2></div></a></article><article><a href=/p/%E6%8B%9C%E5%8D%A0%E5%BA%AD%E5%B0%86%E5%86%9B-%E8%AE%BA%E6%96%87%E7%BF%BB%E8%AF%91/><div class=article-details><h2 class=article-title>拜占庭将军 - 论文翻译</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//weasley.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 Kunkka</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>